<!DOCTYPE html>
<html>
<head>
    <title>Sherpa | Automation Hub</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- NAVBAR -->
<div class="navbar">
    <div class="nav-item active" onclick="switchTab('automation', this)">‚öô Automation Runner</div>
    <div class="nav-item" onclick="switchTab('dpm', this)">üìÑ DPM Mapping</div>
</div>

<div class="container">

    <h1>üß© Sherpa</h1>
    <p class="subtitle">Handle with care</p>

    <!-- TAB 1: AUTOMATION UI -->
    <div id="automation" class="page">

        <label>Validation Sheet URL</label>
        <input id="validation" placeholder="Paste validation sheet link">

        <label>Workbook Sheet URL</label>
        <input id="workbook" placeholder="Paste workbook sheet link">

        <button id="runBtn" onclick="runAutomation()">üöÄ Run Automation</button>
    </div>

    <!-- TAB 2: DPM UI -->
    <div id="dpm" class="page" style="display:none;">

        <label>Google Sheet URL</label>
        <input id="dpmSheet" placeholder="Paste sheet link">

        <button id="dpmBtn" onclick="runDpmMapping()">üß† Generate Device Mapping</button>
    </div>

    <pre id="result">Waiting for input...</pre>

    <div class="footer">Built by <strong>Shashi</strong> ‚ö°</div>
</div>

<script>

function switchTab(tab, element) {

    document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
    document.getElementById(tab).style.display = 'block';

    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    element.classList.add('active');

    document.getElementById("result").textContent = "Waiting for input...";
}

async function runAutomation() {
    const validationUrl = document.getElementById("validation").value;
    const workbookUrl = document.getElementById("workbook").value;
    const output = document.getElementById("result");

    if (!validationUrl || !workbookUrl) return alert("‚ö† Please enter both sheet URLs");

    output.textContent = "‚è≥ Running automation... please wait...";

    try {
        const res = await fetch("/api/run", {
            method: "POST",
            headers: { "Content-Type": "application/json"},
            body: JSON.stringify({ validationUrl, workbookUrl })
        });

        output.textContent = await res.text();
    } catch (err) {
        output.textContent = "‚ùå Error: " + err.message;
    }
}

async function runDpmMapping() {
    const sheetUrl = document.getElementById("dpmSheet").value;
    const output = document.getElementById("result");
    
    if (!sheetUrl) return alert("‚ö† Please enter Sheet URL");

    output.textContent = "‚è≥ Fetching mapping... please wait...";

    try {
        const res = await fetch("/dpm/group");
        const data = await res.json();
        output.textContent = data.join("\n");
    } catch (err) {
        output.textContent = "‚ùå Error: " + err.message;
    }
}

</script>

</body>
</html>
